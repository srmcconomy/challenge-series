{"version":3,"sources":["util/db.js"],"names":["syncPromise","enemies","Enemy","findAll","enemyList","Map","map","enemy","name","value","players","Player","include","model","PlayerEnemy","playerList","score","player","PlayerEnemies","reduce","playerEnemy","Set","enemyChecklist","srlPlayers","List","getInitialState","sequelize","Sequelize","config","db","user","password","host","logging","define","STRING","INTEGER","hasMany","belongsTo","sync"],"mappings":";;;;;;;;+BAgCO,aAAwC;AAC7C,UAAMA,WAAN;AACA,UAAMC,UAAU,MAAMC,MAAMC,OAAN,EAAtB;AACA,UAAMC,YAAY,IAAIC,cAAJ,CAAQJ,QAAQK,GAAR,CAAY;AAAA,aAAS,CAC7CC,MAAMC,IADuC,EAE7CD,MAAME,KAFuC,CAAT;AAAA,KAAZ,CAAR,CAAlB;AAIA,UAAMC,UAAU,MAAMC,OAAOR,OAAP,CAAe;AACnCS,eAAS;AACPC,eAAOC,WADA;AAEPF,iBAAS;AACPC,iBAAOX;AADA;AAFF;AAD0B,KAAf,CAAtB;AAQA,UAAMa,aAAa,IAAIV,cAAJ,CAAQK,QAAQJ,GAAR,CAAY,kBAAU;AAC/C,YAAMU,QAAQC,OAAOC,aAAP,CAAqBC,MAArB,CACZ,UAACV,KAAD,EAAQW,WAAR;AAAA,eAAwBX,QAAQW,YAAYlB,KAAZ,CAAkBO,KAAlD;AAAA,OADY,EAEZ,CAFY,CAAd;AAIA,aAAO,CACLQ,OAAOT,IADF,EAEL;AACEQ,aADF;AAEEf,iBAAS,IAAIoB,cAAJ,CAAQJ,OAAOC,aAAP,CAAqBZ,GAArB,CACf;AAAA,iBAAec,YAAYlB,KAAZ,CAAkBM,IAAjC;AAAA,SADe,CAAR;AAFX,OAFK,CAAP;AASD,KAd0B,CAAR,CAAnB;;AAgBA,WAAO;AACLc,sBAAgB;AACdlB,iBADc;AAEdW,kBAFc;AAGdQ,oBAAY,IAAIC,eAAJ;AAHE;AADX,KAAP;AAOD,G;;kBAtCqBC,e;;;;;AAhCtB;;;;AACA;;AAEA;;;;;;;;AAGA,MAAMC,YAAY,IAAIC,mBAAJ,CAChBC,iBAAOC,EAAP,CAAUrB,IADM,EAEhBoB,iBAAOC,EAAP,CAAUC,IAFM,EAGhBF,iBAAOC,EAAP,CAAUE,QAHM,EAIhB;AACEC,QAAMJ,iBAAOC,EAAP,CAAUG,IADlB;AAEEC,WAAS;AAFX,CAJgB,CAAlB;;AAUO,MAAMtB,0BAASe,UAAUQ,MAAV,CAAiB,QAAjB,EAA2B;AAC/C1B,QAAMmB,oBAAUQ;AAD+B,CAA3B,CAAf;;AAIA,MAAMjC,wBAAQwB,UAAUQ,MAAV,CAAiB,OAAjB,EAA0B;AAC7C1B,QAAMmB,oBAAUQ,MAD6B;AAE7C1B,SAAOkB,oBAAUS;AAF4B,CAA1B,CAAd;;AAKA,MAAMtB,oCAAcY,UAAUQ,MAAV,CAAiB,aAAjB,CAApB;;AAEPvB,OAAO0B,OAAP,CAAevB,WAAf;AACAA,YAAYwB,SAAZ,CAAsBpC,KAAtB;;AAEA,MAAMF,cAAc0B,UAAUa,IAAV,EAApB","file":"db.js","sourcesContent":["import Sequelize from 'sequelize';\nimport { Map, Set, List } from 'immutable';\n\nimport config from '../../config';\nimport type { State } from '../reducers';\n\nconst sequelize = new Sequelize(\n  config.db.name,\n  config.db.user,\n  config.db.password,\n  {\n    host: config.db.host,\n    logging: false,\n  }\n);\n\nexport const Player = sequelize.define('Player', {\n  name: Sequelize.STRING,\n});\n\nexport const Enemy = sequelize.define('Enemy', {\n  name: Sequelize.STRING,\n  value: Sequelize.INTEGER,\n});\n\nexport const PlayerEnemy = sequelize.define('PlayerEnemy');\n\nPlayer.hasMany(PlayerEnemy);\nPlayerEnemy.belongsTo(Enemy);\n\nconst syncPromise = sequelize.sync();\n\nexport async function getInitialState(): State {\n  await syncPromise;\n  const enemies = await Enemy.findAll();\n  const enemyList = new Map(enemies.map(enemy => [\n    enemy.name,\n    enemy.value\n  ]));\n  const players = await Player.findAll({\n    include: {\n      model: PlayerEnemy,\n      include: {\n        model: Enemy,\n      }\n    }\n  });\n  const playerList = new Map(players.map(player => {\n    const score = player.PlayerEnemies.reduce(\n      (value, playerEnemy) => value + playerEnemy.Enemy.value,\n      0\n    );\n    return [\n      player.name,\n      {\n        score,\n        enemies: new Set(player.PlayerEnemies.map(\n          playerEnemy => playerEnemy.Enemy.name\n        )),\n      },\n    ];\n  }));\n\n  return {\n    enemyChecklist: {\n      enemyList,\n      playerList,\n      srlPlayers: new List(),\n    },\n  };\n}\n"]}